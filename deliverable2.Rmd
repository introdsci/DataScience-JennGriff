---
title: "Model Planning and Model Building"
author: "Jennifer Griffiths"
date: "November 18, 2019"
output: html_document
---
```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
include <- function(library_name){
  if( !(library_name %in% installed.packages()) )
    install.packages(library_name) 
  library(library_name, character.only=TRUE)
}
library(data.table)
#janitor package for cleaning column names
include("janitor")
include("tidyverse")
include("caret")
include("knitr")
purl("deliverable1.Rmd", output = "part1.r") # produces r source from rmd
source("part1.r") # executes the source
```
#The Previous Data
Here is a snipit of the tables that were used in the previous stage of the project:
```{r}
#This is a snippet of the original table after gather the years into a single column
head(Indicators)
#Each of the 14 dimensions was subset into its own table (tibble)
unique(Indicators$dimension)
```
The dimensions are the categories of data that may indicate a countries quality human development. The dimensions have sub-categories called 'indicators' (e.g. Dimension: Education, Indicator: Literacy Rate ) The indicator values, across all dimentions are calculated by the United Nations to give a single Human Develoment Index score. For 2019 the top ranked country is Norway, with the United States coming in at number 12.
```{r}
#The structure of the tibble for the dimension: Education 
head(Education)
#The structure of the tibble for the dimension: Poverty
head(Poverty)
```

#Additional Dataset
##Retrieved from the Food Security Portal API
Which delivers the data in the form of either HTML or CSV. I opted for the CSV verion as I am more comfortable with CSV structure:
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
AgGDP <- fread('http://www.foodsecurityportal.org/api/countries/agriculture-value-ad.csv')
names(AgGDP)
```
Looking at the structure of the table, the first row should be the column names, lets make that happen. 
```{r}
#grab the first row with the column names
names(AgGDP) <- as.matrix(AgGDP[1, ])
#remove the first row from the table
AgGDP <- AgGDP[-1, ]
#apply the names to the columns
AgGDP[] <- lapply(AgGDP, function(x) type.convert(as.character(x)))
head(AgGDP)
```


##Agriculture, Value Added (% GDP)
This dataset documents a counties annual agricultural value added to thier GDP for 1960 - 2016. The agricultural value is the net output of the Agricultural sector which includes forestry, hunting and fishing, and cultivation of crops and livestock production.

##Tidy up
Lets gather all these years into a single column and remove the NA values while we're here.
```{r}
AgGDP <-gather(AgGDP, key = Years, "Percent_GDP", 2:58, na.rm = TRUE)
head(AgGDP)
```

##Plot The Data
Lets explore what insights we may gain from the Agricultural GDP data

```{r}
plot <- ggplot(AgGDP, aes(Country, Percent_GDP) ) + geom_col() + geom_path(colour = "red", na.rm = TRUE)
# Rename the x, Y axis to make graph communnicate more clearly
plot + ggtitle("Explore") + theme(axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks = element_blank()) + xlab("Coutries") + ylab("Percent of GDP From Agticulture")
```

###Interpretation 
From this plot it's evident that there is quite a spread among countries in their agricultural contributions to GDP. The goal here is to find varibles that can predict a countries percentage of GDP coming from agriculture.

In order to combine the two datsets lets aggregate the "Percent of GDP from Agriculture" into an average overtime. This will give us a starting point to explore interesting relationships.

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}


##Making the column names identical, so joining tables by country name is an easier process

colnames(HDI)[colnames(HDI) == "Country" ] <- "country_name"
colnames(AgGDP)[colnames(AgGDP) == "Country" ] <- "country_name"

#Join tables by country name and years
df <- AgGDP %>% full_join(Indicators,by=c("country_name", "Years") )  %>%  na.omit(df) %>% clean_names()
names(df)
head(df)
```
##Lets set up our model
```{r}
##FOR df TABLE
set.seed(789)

# pass in y value (to be predicted)
sample_selection <- createDataPartition(df$percent_gdp, p = 0.75, list = FALSE)
  
train <- df[sample_selection, ]
test <- df[-sample_selection, ]
```


##BUILD MODEL FOR ALL VARIABLES::
```{r}
train_model <- lm(percent_gdp ~ 
                  dimension 
                  + indicator_id
                  + iso3 
                  + years
                  + hdi_value
                    , data = train)
summary(train_model)

```

  This summary tells us that the iso3 (officially assigned country codes) is a significant indicatior, which is not meaningful - as the percent of a countries GPD that is Agricultural is directly linked to the country. 
  
  Lets remove some of the variables to clean up this model. "Years" and "iso" are irrelevant relationships because the country and the year are information that directly link the annual agricultual GDP to a country. Lets also remove dimentions as that vRble has a consistant high P-value across all levels - meaning none of the dimension categories are statistically significant. 
###Revised Model
```{r}
train_model <- lm(percent_gdp ~
                   indicator_id
                  + hdi_value
                    , data = train)
summary(train_model)

```
With this revised model we can see more of the indicators that would be considered statistically significant (low P-Values marked with astericks). There are a total of 74 'indicator id's" and the HDI value which gives the grand total of 75 statistically significant markers for a countries annual percentage of GDP comming from Agriculture. 

#Significant indicator (indicator id : 52606) 
```{r}
Significant_indicator <- subset(Indicators, indicator_id == "52606")
Significant_indicator[1,]
```

  Within the dimension "Trade and financial flows" the "Remittances, inflows (% of GDP)" is significant. This is interesting. A remittance is a transfer of money by a foreign worker to an individual in thier home country. A country with a large percentage of thier GDP coming from "Remittances, inflows" would be considered a labor-exporting country where much of the money they earn outside of thier home country is sent to back home. An example of this is India, currently the top reciever of remittance. 
So potentially the indicator "Remittances, inflows (% of GDP)" can be a predictor for the percentage of the GDP that is Agricultural. 


###Percentage of GDP from Agriculture and Remittances, inflows (% of GDP)
```{r}
AgToRemittance <- subset(df, indicator_id == "52606" )
ggplot(AgToRemittance, aes(x = hdi_value, y = percent_gdp)) + geom_point() + geom_smooth() + ggtitle("Percentages of GDP") + theme(axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks = element_blank()) + xlab("Remittances: Inflow") + ylab("Agricultural Products") 
```

###Assessment of Graph
This is an interesting shape. The clustering around the origin can be explained by the fact HDI value is a percentage where in some cases the percentage of remittances contributing to GDP is above 100%. Lets look at this graph on a smaller scale, say from 0 - 100 % to see the cluster more clearly.

```{r warning=FALSE}
ggplot(AgToRemittance, aes(x = hdi_value, y = percent_gdp)) + geom_point() + geom_smooth() + ggtitle("Percentages of GDP") + theme(axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks = element_blank()) + xlab("Remittances: Inflow") + ylab("Agricultural Products") + xlim(0, 1)
```

This does not look like a terribly interesting relationship, but still valuable. 

#Significant indicator (indicator id : 53506) 
```{r}
Sig_indicator <- subset(Indicators, indicator_id == "53506")
Sig_indicator[2,]
```

###Percentage of GDP from Agriculture and Total debt service (% of exports of goods, services and primary income)
Our X value here is the HDI value which is the percentage value for the indicator "Foreign direct investment, net inflows (% of GDP)". 
```{r}
AgToDebt <- subset(df, indicator_id == "174206" )
ggplot(AgToDebt, aes(x = hdi_value, y = percent_gdp)) + geom_col() + ggtitle("Agricultural Production Related to") + theme(axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks = element_blank()) + xlab("") + ylab("Agricultural Products - Percent of GDP")
```

###Assessment of Graph
















_______________________________

###Model Evaluation

This model is in need of more related information in order to explore the idea that a countries Agricultural production may be related to the quality of life in a country. Data on the proportion of agricultural production that is either a deficit or surplus in realtion to feeding it's local population. The amount of food imports, exports, and food aid recieved/sent complicates the calculation. 

### TABLES USED CREATING THE MODEL
```{r}
head(AgGDP)
head(df)
```

        

  


